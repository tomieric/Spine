// 类似于 backbone的mvc mini框架
// v1.0.0
// 依赖于 jQuery，自带JS 模板引擎
// 面向对象可扩展
// by tommyshao
var Spine=(function(){var e=(function(){var h=function(j,i){for(var k in i){if(i.hasOwnProperty(k)){j[k]=i[k]}}};var f=function(){this.initPrototype=true;var j=new this();this.initPrototype=false;var i=Array.prototype.slice.call(arguments)||[];var k;while(k=i.shift()){h(j,k.prototype||k)}function l(){if(!l.initPrototype&&this.init){this.init.apply(this,arguments)}}l.prototype=j;l.prototype.constructor=l;l.extend=f;return l};var g=function(){};g.extend=f;return g})();var c=function(j,h){if(j===null){return -1}var f=0,g=j.length;for(;f<g;f++){if(j[f]===h){return f}}return -1};var a=e.extend({on:function(f,g){if(!this.__events){this.__events={}}if(!this.__events[f]){this.__events[f]=[]}if(c(this.__events,g)===-1&&typeof g==="function"){this.__events[f].push(g)}return this},fire:function(j){if(!this.__events||!this.__events[j]){return}var g=Array.prototype.slice.call(arguments,1)||[];var k=this.__events[j];var h=0;var f=k.length;for(h;h<f;h++){k[h].apply(this,g)}return this},off:function(g,i){if(!g&&!i){this.__events={}}if(g&&!i){delete this.__events[g]}if(g&&!i){var h=this.__events[g];var f=c(h,i)(f>-1)&&h.splice(f,1)}return this}});var b=e.extend(a,{init:function(f){this.__config=f;this.bind();this.render()},get:function(f){return this.__config[f]},set:function(f,g){this.__config[f]=g},bind:function(){},render:function(){},destroy:function(){this.off()}});var d=b.extend({EVENTS:{},template:"",init:function(f){this.__config=f;this._delegateEvent();this.initialize()},_delegateEvent:function(){var h=this;var i=this.EVENTS||{};var l,k,g,j;var f=this.get("parentNode")||$(document.body);for(g in i){l=i[g];for(j in l){k=l[j];(function(m){f.on(j,g,function(o){var n=[].slice.call(arguments);n.unshift(h);m.apply(this,n)})})(k)}}},_parseTemplate:function(h,g){var f=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+h.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return g?f(g):f},initialize:function(){this.render()},setChuckdata:function(i,k){var g=this;var j=g.get("__renderData");j[i]=k;if(!this.template){return}var f=$(g._parseTemplate(this.template,j));var h=g.get("__currentNode");if(!h){return}h.replaceWith(f);g.set("__currentNode",f)},render:function(j){var g=this;g.set("__renderData",j);if(!this.template){return}var i=g._parseTemplate(this.template,j);var f=this.get("parentNode")||$(document.body);var h=$(i);g.set("__currentNode",h);f.append(h)},destroy:function(){var h=this;h.off();h.get("__currentNode").remove();var i=h.EVENTS||{};var l,k,g,j;var f=h.get("parentNode");for(g in i){l=i[g];for(j in l){k=l[j];f.off(j,g,k)}}}});return d})();
